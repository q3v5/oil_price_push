# Workflow名称
name: 内蒙古油价自动推送

# 触发条件：支持「定时触发」+「手动触发」
on:
  # 手动触发（点击仓库Actions→选择该Workflow→Run workflow）
  workflow_dispatch:
  # 定时触发（Cron表达式，UTC时间，需转换为中国时区：UTC+8）
  # 示例：每天北京时间8点运行（UTC时间0点）
  schedule:
    - cron: '0 0 * * *'

# 运行权限
permissions:
  contents: read

# 运行作业
jobs:
  push_oil_price:
    # 运行环境：Ubuntu最新版
    runs-on: ubuntu-latest
    # 设置中国时区（关键：避免日期判断错误）
    env:
      TZ: Asia/Shanghai
    steps:
      # 步骤1：拉取仓库代码到运行环境
      - name: Checkout code
        uses: actions/checkout@v4

      # 步骤2：设置Python环境（匹配脚本运行的Python版本）
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'  # 推荐3.8+，兼容requests库

      # 步骤3：安装脚本依赖（仅需requests库）
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      # 步骤4：运行油价推送脚本（传递Secrets为环境变量）
      - name: Run oil price push script
        env:
          # 将GitHub Secrets映射为环境变量，脚本中通过os.getenv读取
          PUSHPLUS_TOKEN: ${{ secrets.PUSHPLUS_TOKEN }}
          TANSHU_API_KEY: ${{ secrets.TANSHU_API_KEY }}
        run: |
          python oil_price_push.py
